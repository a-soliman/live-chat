<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Live Chat</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="css/main.css">
	</head>
	<body>
		<section class="container-fluid bg">
			<div class="container">
				<div class="row">
					<div class="col-xs-12">
						<div class="wrapper">
							<form id="chat-form">
								<header>Chatroom</header>
								<div class="user">
									<label for="user_name">User Name:</label>
									<input type="text" id="user_name" name="user_name" class="form-control" value="">
								</div>
								<div class="chatID">
									<label for="chat_id">Last Displayed chat ID</label>
									<input type="text" id="last_displayed_chat_id" name="last_displayed_chat_id" class="form-control" value="0">
								</div> <!--chat_id-->
								<div class="chat_box">
									<label for="chat_box">Chat</label>
									<textarea name="chat_box" id="chat_box" cols="30" rows="10" class="form-control"></textarea>
								</div> <!--chat-->
								<div class="message">
									<label for="user_comment">Message:</label>
									<input type="text" id="user_comment" name="user_comment" class="form-control">
									<br />
									<button class="btn btn-primary"  type="submit">Send</button>
								</div> <!--message-->
							</form>
						</div>
					</div>
				</div>
			</div>
		</section>	

		


		<!-- ******Jquery GOOGLE CDN***** -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<script src="js/main.js"></script>
		<script>

			function addComment() {

				if( $('#user_name').val().length === 0 ) {
					alert ('Please enter your "user name"')
					return false
				}
				
				requestData = $('#last_displayed_chat_id, #user_name, #user_comment').serialize()
				$.ajax ({
					url : 'http://localhost/chat_ajax/server.php',
					type : 'GET',
					data : requestData ,
					dataType : 'json' ,
					success : function( response, status , http) {
						$.each( response, function( index, item) {
							$('#chat_box').val($('#chat_box').val() + item.user_name + ' : ' + item.user_comment + '\n')
							$('#last_displayed_chat_id').val( item.chat_id )
						})
						$('#user_comment').val('')
					},
					error : function( http, status, error) {
						alert('Some error occured : ' + error)
					}
				})
			}


			function updateChat() {
				$.ajax ({
					url : 'http://localhost/chat_ajax/server.php',
					type : 'GET',
					data : 'last_displayed_chat_id=' + $('#last_displayed_chat_id').val() ,
					dataType : 'json' ,
					success : function( response, status , http) {
						$.each( response, function( index, item) {
							$('#chat_box').val($('#chat_box').val() + item.user_name + ' : ' + item.user_comment + '\n')
							$('#last_displayed_chat_id').val( item.chat_id )
						})
					},
					error : function( http, status, error) {
						alert('Some error occured : ' + error)
					}
				})
			}

			// updateChat()
			setInterval( updateChat , 4000 )
		</script>

	</body>
</html>